<html>
<head>
    <title>Conversion</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="http://cdn.jsdelivr.net/sockjs/0.3/sockjs.min.js"></script>
    <link rel = "stylesheet" type="text/css" href="/static/default.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Lato:300' rel='stylesheet' type='text/css'>
    <script type="text/jsx" src="/static/react_renders.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script>
         var conn = new SockJS('http://' + window.location.host + ':8084/ws');
         console.log('http://' + window.location.host + ':8084/ws');
         conn.onmessage = function(e){
             if (e.type === 'message' && e.data==="done"){
                 $('#notReady').text("READY! Grab your file!");
             } else if (e.type === 'message') {
                 $('#status-current').text(e.data.frame + ' of ' + e.data.all_frames);
                 $('#status-percent').text("That's " + Math.floor(e.data.frame*100 / e.data.all_frames) + "%" );
             }
             console.log(e);
         };
        conn.onopen = function(e){
            conn.send($('#token').text())
         }
    </script>
</head>
<body>
    <header>
        <div id="header"></div>
    </header>
    <h2>Conversion in progress</h2>
    <div id="notReady">
        Your token is <span id="token">{{ token }}</span>
        We will notify you on this page when conversion ends, or you can visit {{file_url}}
        <div id="status">
            <span id="status-text">Status: </span> <span id="status-current">0</span>  <span id="status-text-frames"> frames converted</span>
            <br>
            <span id="status-percent"></span>
        </div>
    </div>
    <div><a href={{file_url}}>Your file page</a></div>
</body>
</html>